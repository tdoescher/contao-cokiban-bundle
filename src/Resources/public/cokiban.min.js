(()=>{document.addEventListener("alpine:init",()=>{Alpine.prefix("data-x-"),Alpine.store("cokiban",{id:null,name:"",version:null,days:null,active:!0,googleConsentMode:!1,date:null,show:!1,details:!1,cache:{},valid:{},initialize(e){let a=this;a.id=e.id,a.name=e.name,a.version=e.version,a.days=e.days,a.active=e.active,a.googleConsentMode=e.googleConsentMode,Array.isArray(e.cookies)&&e.cookies.forEach(s=>{a.cache[s]=!1}),a.valid=Object.assign({},a.cache),a.pages=e.pages,a.loadConfig(),a.active!==!1&&(a.date===null||a.days&&a.date+a.days*864e5<new Date().getTime())&&a.openBanner()},loadConfig(){let e=this,a=localStorage.getItem(e.name);try{a=JSON.parse(a)}catch{a=null}a!==null&&a.version===e.version&&(e.date=a.date,Object.keys(a.cookies).forEach(s=>{e.cache[s]!==void 0&&(e.cache[s]=a.cookies[s])}),e.valid=Object.assign({},e.cache)),e.updateGoogleConsentMode(!0)},saveConfig(){let e=this;e.valid=Object.assign({},e.cache),localStorage.setItem(e.name,JSON.stringify({id:e.id,version:e.version,date:new Date().getTime(),cookies:e.valid})),e.closeBanner(),e.updateGoogleConsentMode()},acceptAll(){let e=this;Object.keys(e.cache).forEach(a=>{e.cache[a]=!0}),clearInterval(this.counter),e.saveConfig()},showDetails(){this.details=!this.details},saveSettings(){this.saveConfig()},switchCookie(e){let a=this,s=e.split(/[A-Z]/)[0],n=!0;a.cache[e]=!a.cache[e],Object.keys(a.cache).forEach(t=>{t!==e&&t.startsWith(e)&&(a.cache[t]=a.cache[e]),t!==s&&t.startsWith(s)&&!a.cache[t]&&(n=!1)}),a.cache[s]=n},openBanner(){this.details=!1,this.show=!0},closeBanner(){this.show=!1},updateGoogleConsentMode(e=!1){let a=this;window.dataLayer=window.dataLayer||[];function s(){window.dataLayer.push(arguments)}if(a.googleConsentMode){if(e){let t={};Object.keys(a.cache).forEach(i=>{let o=i.match(/[A-Z].*$/);o&&(t[o[0].toLowerCase()+"_storage"]="denied")}),s("consent","default",t)}let n={ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied"};Object.keys(a.cache).forEach(t=>{t==="marketing"&&a.cache.marketing&&(n.ad_storage="granted",n.ad_user_data="granted",n.ad_personalization="granted");let i=t.match(/[A-Z].*$/);i&&(n[i[0].toLowerCase()+"_storage"]=a.cache[t]?"granted":"denied")}),setTimeout(()=>{s("consent","update",n)},50)}},bindCokiban:{"data-x-bind:class"(){return{"cokiban--show":this.show}}},bindDetails:{"data-x-on:click.prevent"(){this.showDetails()}},bindSwitch:{"data-x-on:change"(e){this.switchCookie(e.target.dataset.cookie)}},bindSaveSettings:{"data-x-on:click"(){this.saveSettings()}},bindAcceptAll:{"data-x-on:click"(){this.acceptAll()}},bindOpenBanner:{"data-x-on:click.prevent"(){this.$store.cokiban.openBanner()}}})});})();
