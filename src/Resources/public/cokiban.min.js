(()=>{document.addEventListener("alpine:init",()=>{Alpine.prefix("data-x-"),Alpine.store("cokiban",{id:null,name:"",version:null,days:null,active:!0,date:null,show:!1,details:!1,cache:{},valid:{},googleConsentMode:!1,googleConsentModeDefault:{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied"},initialize(a){let e=this;e.id=a.id,e.name=a.name,e.version=a.version,e.days=a.days,e.active=a.active,e.googleConsentMode=a.googleConsentMode,Array.isArray(a.cookies)&&a.cookies.forEach(t=>e.cache[t]=!1),e.updateGoogleConsentMode(!0),e.valid=Object.assign({},e.cache),e.pages=a.pages,e.loadConfig(),e.active!==!1&&(e.date===null||e.days&&e.date+e.days*864e5<new Date().getTime())&&e.openBanner()},loadConfig(){let a=this,e=localStorage.getItem(a.name);try{e=JSON.parse(e)}catch{e=null}e!==null&&e.version===a.version&&(a.date=e.date,Object.keys(e.cookies).forEach(t=>{a.cache[t]!==void 0&&(a.cache[t]=e.cookies[t])}),a.valid=Object.assign({},a.cache)),setTimeout(()=>a.updateGoogleConsentMode(),200)},saveConfig(){let a=this;a.valid=Object.assign({},a.cache),localStorage.setItem(a.name,JSON.stringify({id:a.id,version:a.version,date:new Date().getTime(),cookies:a.valid})),a.closeBanner(),a.updateGoogleConsentMode()},acceptAll(){let a=this;Object.keys(a.cache).forEach(e=>{a.cache[e]=!0}),clearInterval(this.counter),a.saveConfig()},showDetails(){this.details=!this.details},saveSettings(){this.saveConfig()},switchCookie(a){let e=this,t=a.split(/[A-Z]/)[0],s=!0;e.cache[a]=!e.cache[a],Object.keys(e.cache).forEach(n=>{n!==a&&n.startsWith(a)&&(e.cache[n]=e.cache[a]),n!==t&&n.startsWith(t)&&!e.cache[n]&&(s=!1)}),e.cache[t]=s},openBanner(){this.details=!1,this.show=!0},closeBanner(){this.show=!1},updateGoogleConsentMode(a=!1){let e=this;window.dataLayer=window.dataLayer||[];function t(){window.dataLayer.push(arguments)}if(e.googleConsentMode)if(a){let s={...e.googleConsentModeDefault};Object.keys(e.cache).forEach(n=>{let o=n.match(/[A-Z].*$/);o&&(s[o[0].toLowerCase()+"_storage"]="denied")}),t("consent","default",s)}else{let s={...e.googleConsentModeDefault};Object.keys(e.cache).forEach(n=>{n==="marketing"&&e.cache.marketing&&(s.ad_storage="granted",s.ad_user_data="granted",s.ad_personalization="granted"),n==="trackingAnalytics"&&e.cache.trackingAnalytics&&(s.analytics_storage="granted");let o=n.match(/[A-Z].*$/);o&&(s[o[0].toLowerCase()+"_storage"]=e.cache[n]?"granted":"denied")}),t("consent","update",s),t({event:"cookie_consent_update"})}},bindCokiban:{"data-x-bind:class"(){return{"cokiban--show":this.show}}},bindDetails:{"data-x-on:click.prevent"(){this.showDetails()}},bindSwitch:{"data-x-on:change"(a){this.switchCookie(a.target.dataset.cookie)}},bindSaveSettings:{"data-x-on:click"(){this.saveSettings()}},bindAcceptAll:{"data-x-on:click"(){this.acceptAll()}},bindOpenBanner:{"data-x-on:click.prevent"(){this.$store.cokiban.openBanner()}}})});})();
