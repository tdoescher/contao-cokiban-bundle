(()=>{document.addEventListener("alpine:init",()=>{Alpine.prefix("data-x-"),Alpine.store("cokiban",{id:null,name:"",version:null,days:null,active:!0,date:null,showBanner:!1,renderBanner:!1,showHint:!1,renderHint:!1,hint:{text:"...",title:"Accept",button:"Accept",function:null},details:!1,labels:{},cache:{},valid:{},googleConsentMode:!1,googleConsentModeDefault:{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied"},loadConfig(){let t=localStorage.getItem(this.name);try{t=JSON.parse(t)}catch{t=null}t!==null&&t.version===this.version&&(this.date=t.date,Object.keys(t.cookies).forEach(e=>{this.cache[e]!==void 0&&(this.cache[e]=t.cookies[e])}),this.valid=Object.assign({},this.cache)),setTimeout(()=>this.updateGoogleConsentMode(),200)},saveConfig(){this.valid=Object.assign({},this.cache),localStorage.setItem(this.name,JSON.stringify({id:this.id,version:this.version,date:new Date().getTime(),cookies:this.valid})),this.closeBanner(),this.updateGoogleConsentMode()},accept(t){this.cache[t]||(this.switchCookie(t),this.saveConfig())},acceptAll(){Object.keys(this.cache).forEach(t=>{this.cache[t]=!0}),this.saveConfig()},saveSettings(){this.saveConfig()},switchCookie(t){let e=t.split(/[A-Z]/)[0],i=!0;this.cache[t]=!this.cache[t],Object.keys(this.cache).forEach(s=>{s!==t&&s.startsWith(t)&&(this.cache[s]=this.cache[t]),s!==e&&s.startsWith(e)&&!this.cache[s]&&(i=!1)}),this.cache[e]=i},openBanner(){this.details=!1,this.renderBanner||(this.renderBanner=!0),this.showBanner=!0},openHint(t){t.text&&t.title&&t.button&&t.callback&&(this.hint.text=t.text,this.hint.title=t.title,this.hint.button=t.button,this.hint.callback=t.callback,this.renderHint||(this.renderHint=!0),this.showHint=!0)},closeBanner(){this.showBanner=!1},acceptHint(){this.showHint=!1,this.hint.callback()},closeHint(){this.showHint=!1},updateGoogleConsentMode(t=!1){let e=this;window.dataLayer=window.dataLayer||[];function i(){window.dataLayer.push(arguments)}if(e.googleConsentMode)if(t){let s={...e.googleConsentModeDefault};Object.keys(e.cache).forEach(a=>{let n=a.match(/[A-Z].*$/);n&&(s[n[0].toLowerCase()+"_storage"]="denied")}),i("consent","default",s)}else{let s={...e.googleConsentModeDefault};Object.keys(e.cache).forEach(a=>{a==="marketing"&&e.cache.marketing&&(s.ad_storage="granted",s.ad_user_data="granted",s.ad_personalization="granted"),a==="trackingAnalytics"&&e.cache.trackingAnalytics&&(s.analytics_storage="granted");let n=a.match(/[A-Z].*$/);n&&(s[n[0].toLowerCase()+"_storage"]=e.cache[a]?"granted":"denied")}),i("consent","update",s),i({event:"cookie_consent_update"})}}}),Alpine.data("cokibanBanner",()=>({get store(){return Alpine.store("cokiban")},showDetails(){return this.store.details},showOverview(){return!this.store.details},bindCokiban:{"data-x-bind:class"(){return{"cokiban--show-banner":this.store.showBanner,"cokiban--show-hint":this.store.showHint}},"data-x-init"(){let t=this.$el.dataset.cokibanConfig.split(",");this.store.id=t[0],this.store.name="cokiban_store_"+t[0],this.store.version=t[1],this.store.days=t[2],this.store.active=t[3]==="1",this.store.googleConsentMode=t[4]==="1",this.store.labels.switchTrue=this.$el.dataset.cokibanLabelSwitchTrue,this.store.labels.switchFalse=this.$el.dataset.cokibanLabelSwitchFalse;let e=this.$el.dataset.cokibanCookies.split(",");Array.isArray(e)&&e.forEach(i=>this.store.cache[i]=!1),this.store.updateGoogleConsentMode(!0),this.store.valid=Object.assign({},this.store.cache),this.store.loadConfig(),this.store.active!==!1&&(this.store.date===null||this.store.days&&this.store.date+this.store.days*864e5<new Date().getTime())&&this.store.openBanner()}},bindBanner:{"data-x-if"(){return this.store.renderBanner}},bindHint:{"data-x-if"(){return this.store.renderHint}},bindDetailsButton:{"data-x-on:click.prevent"(){this.store.details=!0},"data-x-show"(){return!this.store.details}},bindBackButton:{"data-x-on:click.prevent"(){this.store.details=!1},"data-x-show"(){return this.store.details}},bindSwitch:{"data-x-on:change"(t){this.store.switchCookie(t.target.dataset.cokibanCookie)},"data-x-bind:checked"(){return this.store.cache[this.$el.dataset.cokibanCookie]}},bindSwitchLabel:{"data-x-text"(){return this.store.cache[this.$el.dataset.cokibanCookie]?this.store.labels.switchTrue:this.store.labels.switchFalse}},bindSaveSettings:{"data-x-on:click"(){this.store.saveSettings()}},bindAcceptAll:{"data-x-on:click"(){this.store.acceptAll()}},bindAcceptHint:{"data-x-on:click"(){this.store.acceptHint()},"data-x-bind:title"(){return this.store.hint.title},"data-x-text"(){return this.store.hint.button}},bindCloseHint:{"data-x-on:click"(){this.store.closeHint()}},bindHintText:{"data-x-text"(){return this.store.hint.text}}})),Alpine.data("cokibanButton",()=>({get store(){return Alpine.store("cokiban")},bind:{"data-x-on:click.prevent"(){this.store.openBanner()}}})),Alpine.data("cokibanTemplate",()=>({get store(){return Alpine.store("cokiban")},bind:{"data-x-if"(){return this.$el.dataset.cokibanCookies.split(",").find(t=>this.store.valid[t])}}})),Alpine.data("cokibanReplacement",()=>({get store(){return Alpine.store("cokiban")},bind:{"data-x-if"(){return!this.$el.dataset.cokibanCookies.split(",").find(t=>this.store.valid[t])}}}))});})();
